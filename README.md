# SHP文件提取工具

一个用于批量处理Shapefile文件并将其数据导出到Excel表格的Python工具，特别适用于洪水风险图制作过程中的数据处理需求。

## 工具简介

本工具主要用于处理洪水风险分析中的二维淹没区Shapefile文件（"2D Zones.shp"），能够自动提取关键属性字段并进行单位换算，同时支持生成统计分析表格。该工具提供了图形用户界面（GUI），方便用户操作。

### 核心功能

1. **批量处理SHP文件**：
   - 支持处理单个文件夹内的"2D Zones.shp"文件
   - 支持遍历主文件夹下所有子文件夹中的"2D Zones.shp"文件
   - 自动识别并提取关键字段：element_no、AREA2D、DEPTH2D、T_FLOOD_DU、T_INUDATIO、T_PEAK_2D

2. **数据转换与计算**：
   - 淹没面积转换：AREA2D → 淹没面积(km²)
   - 淹没水深转换：DEPTH2D → 淹没水深(m)
   - 淹没历时转换：T_FLOOD_DU → 淹没历时(h)
   - 洪水到达时间转换：T_INUDATIO → 洪水到达时间(h)

3. **空间数据裁剪功能**：
   - 支持使用网格化区间文件对SHP数据进行裁剪处理
   - 可输出裁剪后的SHP文件

4. **统计分析功能**：
   - 按不同淹没水深范围进行分层统计：<0.5m、0.5~1.0m、1.0~2.0m、2.0~3.0m、>3.0m
   - 计算各层淹没面积及占总面积的比例
   - 提取最大淹没水深和最大淹没历时及其对应的element_no

5. **多编码支持**：
   - 自动尝试多种编码格式（utf-8、gbk、gb2312、latin-1）读取SHP文件，提高兼容性

## 使用步骤

### 1. 准备工作
确保您的系统满足以下要求：
- Windows操作系统（推荐Windows 7及以上版本）
- 已安装本工具的可执行文件（2DzonesPostProcessing.exe）

### 2. 文件组织结构
为了正确使用本工具，请按以下方式组织您的数据文件：

### 3. 基本使用流程

#### 步骤1：启动程序
双击运行`2DzonesPostProcessing.exe`文件启动程序。

#### 步骤2：设置输入文件夹
点击"浏览..."按钮，选择包含"2D Zones.shp"文件的主文件夹。

#### 步骤3：设置输出文件
点击"浏览..."按钮，选择提取结果的保存位置并设置文件名（.xlsx格式）。

#### 步骤4：（可选）设置分析参数
在"编制对象"输入框中填写项目名称，用于后续分析表格中的标识。

#### 步骤5：（可选）设置分析表格输出
如需生成分析表格，点击"分析表格输出"后的"浏览..."按钮设置输出文件路径。

#### 步骤6：执行提取
点击"执行提取"按钮开始处理，处理完成后会弹出提示框。

#### 步骤7：（可选）生成分析表格
如需生成统计分析表格，点击"生成分析表格"按钮。

### 4. 高级功能使用

#### 裁剪功能
如果需要对SHP数据进行裁剪处理：

1. 勾选"裁剪网格化区间"选项
2. 点击"网格化区间文件"后的"浏览..."按钮，选择用于裁剪的SHP文件
3. （可选）点击"裁剪后文件输出"后的"浏览..."按钮，设置裁剪后SHP文件的保存位置
4. 执行提取操作

## 注意事项

1. **文件命名要求**：
   - 待处理的Shapefile文件必须命名为"2D Zones.shp"
   - 确保.shp文件配套的.shx、.dbf等文件在同一目录下

2. **输出文件**：
   - 提取结果将以Excel格式保存，每个子文件夹的数据对应一个工作表
   - 工作表名称与子文件夹名称相同
   - 如果主文件夹内直接包含"2D Zones.shp"，将在Excel中创建名为"Main_Folder"的工作表

3. **编码兼容性**：
   - 工具会自动尝试多种编码格式读取SHP文件，通常无需手动调整
   - 如遇到乱码问题，请确认源SHP文件的编码格式

4. **裁剪功能注意事项**：
   - 裁剪文件和被裁剪文件应具有相同的坐标系统
   - 工具会自动进行坐标系统转换，但仍建议使用相同坐标系统的文件以获得最佳效果

5. **性能考虑**：
   - 处理大量数据时可能需要较长时间，请耐心等待
   - 处理过程中不要强制关闭程序

6. **错误处理**：
   - 如遇错误，可在"处理日志"区域查看详细信息
   - 常见错误包括文件路径错误、文件损坏、权限不足等

## 常见问题

### Q1: 为什么我的SHP文件无法被识别？
A: 请检查以下几点：
- 文件是否命名为"2D Zones.shp"
- 是否有配套的.shx、.dbf等相关文件
- 文件是否损坏
- 文件路径是否包含特殊字符

### Q2: 提取后的Excel文件中某些列为空是怎么回事？
A: 这是因为原始SHP文件中缺少相应的字段。工具会提取以下字段：
- element_no（单元编号）
- AREA2D（淹没面积，mm²）
- DEPTH2D（淹没水深，m）
- T_FLOOD_DU（淹没历时，秒）
- T_INUDATIO（洪水到达时间，秒）
- T_PEAK_2D（峰值时间，秒）

如果原始数据中缺少这些字段，对应的列就会为空。

### Q3: 为什么生成的分析表格没有数据？
A: 请确认：
- 是否已经执行了提取操作并生成了Excel文件
- Excel文件中是否包含"淹没水深(m)"和"淹没面积(km2)"列
- 编制对象是否已填写

### Q4: 裁剪功能如何使用？
A: 裁剪功能用于从原始SHP数据中移除与指定区域重叠的部分：
1. 勾选"裁剪网格化区间"选项
2. 选择用于定义裁剪区域的SHP文件
3. 可选择保存裁剪后的SHP文件
4. 执行提取操作

### Q5: 处理速度很慢怎么办？
A: 处理速度受以下因素影响：
- 数据量大小
- 计算机性能
- 文件存储介质（机械硬盘比固态硬盘慢）

对于大数据量处理，建议：
- 关闭其他占用资源的程序
- 在固态硬盘上进行处理
- 分批次处理数据

### Q6: 工具支持哪些坐标系统？
A: 本工具基于GeoPandas开发，理论上支持所有常见的GIS坐标系统。但在使用裁剪功能时，建议确保所有参与运算的SHP文件使用相同的坐标系统以避免转换误差。

### Q7: 如何获取技术支持？
A: 如果您在使用过程中遇到无法解决的问题，请提供以下信息以便快速定位问题：
- 操作系统版本
- 错误截图或完整的错误信息
- 数据样本（如可能）
- 操作步骤描述

## 依赖环境

本工具打包为独立的Windows可执行文件，无需额外安装依赖。如需从源代码运行，需要以下Python库：
- Python 3.6+
- geopandas
- pandas
- openpyxl
- tkinter

## 版本信息

当前版本：1.0
发布日期：2025年12月1日

## 免责声明

本工具按"现状"提供，不提供任何形式的担保。使用者需自行承担使用风险。开发者不对因使用本工具而导致的任何损失负责。